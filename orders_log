<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Orders Log</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { font-family: Arial, sans-serif; padding:14px; background:#fff; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
.panel { border-radius:8px; padding:12px; box-shadow:0 1px 6px rgba(0,0,0,0.06); background:#fafafa; margin-bottom:12px; }
button { padding:6px 10px; border-radius:6px; cursor:pointer; margin-left:6px; }
.small { font-size:0.9em; color:#666; }
ul { padding-left:18px; }
li { margin-bottom:8px; }
</style>
</head>
<body>
<header>
  <div>
    <h2>Orders Log</h2>
    <div class="small" id="userInfo"></div>
  </div>
  <div>
    <button id="back">Back</button>
    <button id="logout">Logout</button>
  </div>
</header>

<div id="ordersContainer">Loading orders...</div>

<script>
function $(id){ return document.getElementById(id); }
const user = JSON.parse(localStorage.getItem('currentUser') || 'null');
if(!user){ alert('Please log in'); window.location='index.html'; }
$('userInfo').innerText = `Logged in as: ${user.name} (Role: ${user.role})`;

function renderOrders(){
  const container = $('ordersContainer');
  const tickets = JSON.parse(localStorage.getItem('tickets')||'[]');
  container.innerHTML = '';
  if(tickets.length===0){ container.innerHTML = '<p>No orders submitted yet.</p>'; return; }

  tickets.forEach(ticket=>{
    const div = document.createElement('div'); div.className='panel';
    div.innerHTML = `
      <strong>Table ${ticket.tableNumber}</strong> — Server: ${ticket.serverName} — Status: ${ticket.status} <br>
      <em>Created: ${new Date(ticket.createdAt).toLocaleString()}</em>
      <ul>${ticket.items.map(it=>`<li>${it.qty} × ${it.name}${it.modifiers.length?` (${it.modifiers.join(', ')})`:''}</li>`).join('')}</ul>
      <small>Note: ${ticket.note||'None'}</small>
    `;
    container.appendChild(div);
  });
}

$('back').addEventListener('click', ()=> window.history.back());
$('logout').addEventListener('click', ()=> { localStorage.removeItem('currentUser'); window.location='index.html'; });

renderOrders();
</script>
</body>
</html>
