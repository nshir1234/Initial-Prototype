<!doctype html>
// render order
function renderOrder(){
const ul = $('orderItems');
ul.innerHTML='';
state.orderItems.forEach((it, idx)=>{
const li = document.createElement('li'); li.className='ticket-item';
const left = document.createElement('div');
left.innerHTML = `<strong>${it.qty} Ã— ${it.name}</strong><div class="modifier">${(it.modifiers||[]).join(', ')}</div>`;
const right = document.createElement('div');
const edit = document.createElement('button'); edit.innerText='Edit'; edit.onclick=()=>editItem(idx);
const rm = document.createElement('button'); rm.innerText='Remove'; rm.onclick=()=>{ state.orderItems.splice(idx,1); renderOrder(); };
right.appendChild(edit); right.appendChild(rm);
li.appendChild(left); li.appendChild(right);
ul.appendChild(li);
});
if(state.orderItems.length===0) ul.innerHTML = '<li class="small">No items added.</li>';
}


// add/edit item
function addItem(menuItem){
const qty = parseInt(prompt('Quantity', '1')||'1',10);
if(qty<=0){ alert('Quantity must be >=1'); return; }
let modifiers=[];
if(menuItem.modifiers?.length){
const pick = prompt('Modifiers (comma separated) available:\n'+menuItem.modifiers.join(', '),'');
if(pick) modifiers = pick.split(',').map(s=>s.trim()).filter(Boolean);
}
state.orderItems.push({ itemId: menuItem.id, name: menuItem.name, qty, modifiers });
renderOrder();
}


function editItem(idx){
const it = state.orderItems[idx];
const newQty = parseInt(prompt('Quantity', it.qty),10); if(newQty>0) it.qty=newQty;
const newMods = prompt('Modifiers (comma separated)', (it.modifiers||[]).join(','));
it.modifiers = newMods ? newMods.split(',').map(s=>s.trim()).filter(Boolean) : [];
renderOrder();
}


// submit ticket
function submitTicket(){
const tableNumber = parseInt($('tableNumber').value,10);
if(!tableNumber){ alert('Enter table number.'); return; }
if(state.orderItems.length===0){ alert('Add at least one item before submitting.'); return; }
const note = $('orderNote').value||'';
const ticket = { id:'t_'+Date.now(), tableNumber, serverName:user.name, items:JSON.parse(JSON.stringify(state.orderItems)), note, status:'New', createdAt:new Date().toISOString() };
const tickets = JSON.parse(localStorage.getItem('tickets')||'[]');
tickets.push(ticket); localStorage.setItem('tickets', JSON.stringify(tickets));
state.orderItems=[]; renderOrder(); $('orderNote').value='';
$('msg').innerText=`Ticket submitted for Table ${tableNumber} (ID: ${ticket.id}).`;
}


// navigation
$('goKitchen').addEventListener('click',()=>window.location='kitchen.html');
$('goMenu').addEventListener('click',()=>window.location='menu.html');
$('logout').addEventListener('click',()=>{ localStorage.removeItem('currentUser'); window.location='index.html'; });


// wire submit
$('submitOrder').addEventListener('click', submitTicket);


// init
renderMenu(); renderOrder();
</script>
</body>
</html>
