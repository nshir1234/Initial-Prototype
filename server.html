<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Server — Order Entry</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { font-family: Arial, sans-serif; background:#fff; color:#111; padding:12px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
.container { display:flex; gap:16px; flex-wrap:wrap; }
.panel { border-radius:8px; padding:12px; box-shadow:0 1px 6px rgba(0,0,0,0.06); background:#fafafa; }
.left { width:320px; min-width:260px; }
.right { flex:1; min-width:300px; }
.menu-item { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #eee; }
button { padding:8px 10px; border-radius:6px; cursor:pointer; }
ul { list-style:none; padding:0; margin:0; }
.ticket-item { display:flex; justify-content:space-between; padding:6px 0; }
.modifier { font-size:0.85em; color:#666; margin-left:6px; }
.small { font-size:0.9em; color:#666; }
input[type="number"]{ padding:6px; width:80px; }
input[type="text"]{ padding:6px; width:60%; }
</style>
</head>
<body>
<header>
  <div>
    <h2>Server — Order Entry</h2>
    <div class="small" id="serverInfo"></div>
  </div>
  <div>
    <button id="goKitchen">Open Kitchen Board</button>
    <button id="goMenu">Manage Menu</button>
    <button id="logout">Logout</button>
  </div>
</header>

<div class="container">
  <div class="panel left">
    <h3>Menu</h3>
    <div id="menuList"></div>
  </div>
  <div class="panel right">
    <h3>Create Order</h3>
    <label>Table Number: <input id="tableNumber" type="number" min="1" /></label>
    <div style="margin-top:8px;">
      <div id="currentOrderArea">
        <ul id="orderItems"></ul>
      </div>
      <div style="margin-top:10px;">
        <label>Note: <input id="orderNote" placeholder="e.g., allergy info" /></label>
      </div>
      <div style="margin-top:12px;">
        <button id="submitOrder">Submit to Kitchen</button>
      </div>
      <div id="msg" style="margin-top:12px;color:green"></div>
    </div>
  </div>
</div>

<script>
function $(id){ return document.getElementById(id); }

// current user
const user = JSON.parse(localStorage.getItem('currentUser') || 'null');
if(!user || user.role !== 'server'){ alert('Please sign in as Server'); window.location='index.html'; }
$('serverInfo').innerText = `Logged in as: ${user.name} (Role: ${user.role})`;

// initialize menu in localStorage if not present
if(!localStorage.getItem('MENU')){
  const defaultMenu = [
    { id:'m1', name:'Caesar Salad', price:8.50, modifiers:['No Dressing','Extra Dressing'] },
    { id:'m2', name:'Cheeseburger', price:11.00, modifiers:['Well-Done','No Onions','Add Bacon'] },
    { id:'m3', name:'Margherita Pizza', price:12.50, modifiers:['Extra Cheese','No Basil','Gluten-Free'] },
    { id:'m4', name:'Fries', price:4.0, modifiers:['No Salt','Extra Crispy'] }
  ];
  localStorage.setItem('MENU', JSON.stringify(defaultMenu));
}

function getMenu(){ return JSON.parse(localStorage.getItem('MENU')); }
const state = { orderItems: [] };

// render menu list
function renderMenu(){
  const container = $('menuList');
  container.innerHTML = '';
  getMenu().forEach(it=>{
    const div = document.createElement('div');
    div.className='menu-item';
    const left = document.createElement('div');
    left.innerHTML = `<strong>${it.name}</strong><div class="small">$${it.price.toFixed(2)}</div>`;
    const right = document.createElement('div');
    const addBtn = document.createElement('button');
    addBtn.innerText='Add';
    addBtn.onclick = ()=> addItem(it);
    right.appendChild(addBtn);
    div.appendChild(left);
    div.appendChild(right);
    container.appendChild(div);
  });
}

// render order
function renderOrder(){
  const ul = $('orderItems');
  ul.innerHTML='';
  state.orderItems.forEach((it, idx)=>{
    const li = document.createElement('li'); li.className='ticket-item';
    const left = document.createElement('div');
    left.innerHTML = `<strong>${it.qty} × ${it.name}</strong><div class="modifier">${(it.modifiers||[]).join(', ')}</div>`;
    const right = document.createElement('div');
    const edit = document.createElement('button'); edit.innerText='Edit'; edit.onclick=()=>editItem(idx);
    const rm = document.createElement('button'); rm.innerText='Remove'; rm.onclick=()=>{ state.orderItems.splice(idx,1); renderOrder(); };
    right.appendChild(edit); right.appendChild(rm);
    li.appendChild(left); li.appendChild(right);
    ul.appendChild(li);
  });
  if(state.orderItems.length===0) ul.innerHTML = '<li class="small">No items added.</li>';
}

// add/edit item
function addItem(menuItem){
  const qty = parseInt(prompt('Quantity', '1')||'1',10);
  if(qty<=0){ alert('Quantity must be >=1'); return; }
  let modifiers=[];
  if(menuItem.modifiers?.length){
    const pick = prompt('Modifiers (comma separated) available:\n'+menuItem.modifiers.join(', '),'');
    if(pick) modifiers = pick.split(',').map(s=>s.trim()).filter(Boolean);
  }
  state.orderItems.push({ itemId: menuItem.id, name: menuItem.name, qty, modifiers });
  renderOrder();
}

function editItem(idx){
  const it = state.orderItems[idx];
  const newQty = parseInt(prompt('Quantity', it.qty),10); if(newQty>0) it.qty=newQty;
  const newMods = prompt('Modifiers (comma separated)', (it.modifiers||[]).join(','));
  it.modifiers = newMods ? newMods.split(',').map(s=>s.trim()).filter(Boolean) : [];
  renderOrder();
}

// submit ticket
function submitTicket(){
  const tableNumber = parseInt($('tableNumber').value,10);
  if(!tableNumber){ alert('Enter table number.'); return; }
  if(state.orderItems.length===0){ alert('Add at least one item before submitting.'); return; }
  const note = $('orderNote').value||'';
  const ticket = { id:'t_'+Date.now(), tableNumber, serverName:user.name, items:JSON.parse(JSON.stringify(state.orderItems)), note, status:'New', createdAt:new Date().toISOString() };
  const tickets = JSON.parse(localStorage.getItem('tickets')||'[]');
  tickets.push(ticket); localStorage.setItem('tickets', JSON.stringify(tickets));
  state.orderItems=[]; $('orderItems').innerHTML='<li class="small">No items added.</li>'; $('orderNote').value='';
  $('msg').innerText=`Ticket submitted for Table ${tableNumber} (ID: ${ticket.id}).`;
}

// navigation
$('goKitchen').addEventListener('click',()=>window.location='kitchen.html');
$('goMenu').addEventListener('click',()=>window.location='menu.html');
$('logout').addEventListener('click',()=>{ localStorage.removeItem('currentUser'); window.location='index.html'; });

// init
renderMenu(); renderOrder();
</script>
</body>
</html>
